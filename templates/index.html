<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lagrangelo web開発チーム — 観光スポット検索デモ（OSM＋カードUI＋口コミ＋お気に入り）</title>

<!-- Fonts（柔らかい丸ゴ） -->
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

<!-- Leaflet / Cluster -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">

<link rel="stylesheet" href="{{ url_for('static', filename='style.css')}}">
</head>
<body>

<!-- Nav -->
<div class="nav">
  <div class="nav-inner">
    <div class="brand">
      <span class="badge" aria-hidden="true"></span>
      <span>Lagrangelo web開発チーム</span>
    </div>
    <a class="login" href="https://lagrangero-group4.web.app/?v=2" target="_blank" rel="noopener">ログイン</a>
  </div>
</div>

<!-- Hero -->
<section class="hero">
  <div class="hero-inner">
    <h1>旅の「いいね」を地図で集める。</h1>
    <p>雑誌のように眺めて、地図で絞り込む。地方→都道府県→市の絞り込み、地図タップの半径検索＆Shift+ドラッグの四角選択、タグでの発見、さらに場所ごとの口コミと★評価まで、ワンページで完結。</p>
  </div>
</section>

<!-- Search & controls -->
<div class="wrap">
  <div class="search-card">
    <div class="search-top">
      <div class="search-wrap">
        <form id="searchForm" class="search-bar" novalidate>
          <input id="q" type="search" inputmode="search" placeholder="キーワード（未入力でもOK：地域/タグ/範囲で絞込）">
          <button>検索</button>
        </form>
      </div>

      <div class="geo-cascade">
        <select id="regionSelect" aria-label="地方">
          <option value="">地方（未選択）</option>
          
        </select>
        <select id="prefSelect" aria-label="都道府県" disabled>
          <option value="">都道府県（まず地方を選択）</option>
        </select>
        <select id="citySelect" aria-label="市区町村" disabled>
          <option value="">市区町村（まず都道府県を選択）</option>
        </select>
        <button id="clearGeo" class="btn ghost" type="button">× 地域クリア</button>
      </div>

      <!-- 地域データ：HTML属性として保持（JSONファイルは不使用） -->
      <div id="geoData" hidden>
        <div data-region="関東" data-center="35.68,139.76" data-radius="180000" data-zoom="8" data-bbox="138.5,34.5,141.5,36.5">
          <div data-pref="神奈川県" data-center="35.4478,139.6425" data-radius="65000" data-zoom="10" data-bbox="139.0,35.1,139.9,35.6">
            <div data-city="横浜市" data-center="35.4478,139.6425" data-radius="18000" data-zoom="13" data-bbox="139.52,35.36,139.69,35.55"></div>
            <div data-city="川崎市" data-center="35.5308,139.7036" data-radius="14000" data-zoom="13" data-bbox="139.56,35.48,139.8,35.63"></div>
            <div data-city="鎌倉市" data-center="35.3192,139.5467" data-radius="9000" data-zoom="13" data-bbox="139.47,35.27,139.61,35.36"></div>
          </div>
          <div data-pref="東京都" data-center="35.6762,139.6503" data-radius="50000" data-zoom="10" data-bbox="139.35,35.53,139.95,35.9">
            <div data-city="千代田区" data-center="35.6938,139.753" data-radius="3000" data-zoom="13" data-bbox="139.73,35.68,139.78,35.71"></div>
            <div data-city="新宿区" data-center="35.6938,139.7034" data-radius="4000" data-zoom="13" data-bbox="139.67,35.67,139.73,35.72"></div>
          </div>
          <div data-pref="茨城県" data-center="36.3414,140.4468" data-radius="90000" data-zoom="9"></div>
          <div data-pref="栃木県" data-center="36.5658,139.8836" data-radius="80000" data-zoom="9"></div>
          <div data-pref="群馬県" data-center="36.3907,139.0604" data-radius="90000" data-zoom="9"></div>
          <div data-pref="埼玉県" data-center="35.8617,139.6455" data-radius="80000" data-zoom="9"></div>
          <div data-pref="千葉県" data-center="35.6051,140.1233" data-radius="90000" data-zoom="9"></div>
        </div>
      </div>


      <!-- タグフィルタ（自動生成） -->
      <div class="tagbar" id="tagBar" aria-label="タグで絞り込み"></div>
      <div style="text-align:center; margin:-4px 0 4px;">
        <button id="clearTags" class="btn ghost" type="button">タグ解除</button>
      </div>
    </div>

    <label><input type="checkbox" id="onlyFavs"> お気に入りのみ</label>
      
      <label><input type="checkbox" id="onlyDiscount"> 学割ありのみ</label>
      <label><input type="checkbox" id="boundsOnly"> 表示範囲だけ</label>
      <label><input type="checkbox" id="sortByDistance"> 距離順（現在地）</label>
      <button id="locateBtn" class="btn" type="button">◎ 現在地</button>
      <button id="resetBtn" class="btn" type="button">↺ リセット</button>
      <small id="geoStatus" class="muted"></small>
    <small id="favCounter" class="muted"></small>
    </div>
  </div>
</div>

<!-- Main -->
<main class="wrap" style="padding-top:0">
  <section class="layout">
    <div class="panel">
      <h2>スポット <span id="resultCount" class="muted"></span></h2>
      <div class="list" id="list"></div>
    </div>

    <div class="panel">
      <h2 style="margin:0; padding:12px 14px;">地図（タップ＝円 / Shift+ドラッグ＝四角）</h2>
      <div id="map" aria-label="地図"></div>
      <div class="mapbar">
        <div class="radiusWrap">
          <span class="muted">半径</span>
          <input id="radius" type="range" min="100" max="3000" step="50" value="600">
          <span id="radiusVal" class="muted">600m</span>
        </div>
        <div class="pills" aria-label="半径プリセット">
          <button class="pill" data-r="300">300m</button>
          <button class="pill active" data-r="600">600m</button>
          <button class="pill" data-r="1000">1km</button>
          <button class="pill" data-r="2000">2km</button>
        </div>
        <button id="centerHere" class="btn" type="button">⊙ 中心＝現在地</button>
        <span id="stat" class="muted">選択範囲：なし（地図をタップ / Shift+ドラッグ）</span>
      </div>
    </div>
  </section>
</main>

<footer>© 2025 Lagrangelo web開発チーム · タイル: © <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap contributors</a></footer>

<!-- Slide-in Detail Panel -->
<div id="slidePanel" class="panel-detail" aria-live="polite">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
    <h3 id="panelTitle" style="margin:0">詳細</h3>
     <div style="display:flex;gap:8px;align-items:center">
      <button id="favInPanel" class="btn fav-btn" type="button">♡ お気に入り</button>
      <button id="closePanel" class="closeBtn" type="button">閉じる</button>
    </div>
  </div>
  <div id="panelContent" class="content"></div>
  <div class="actions">
    <a id="panelLink" class="btn primary" target="_blank" rel="noopener" href="#">公式/学割ページへ</a>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script src="{{url_for('static', filename='index.js')}}"></script>
</body>
</html>
