<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lagrangelo web開発チーム — 観光スポット検索デモ（OSM＋カードUI＋口コミ＋お気に入り）</title>

<!-- Fonts（柔らかい丸ゴ） -->
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&display=swap" rel="stylesheet">

<!-- Leaflet / Cluster -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">

<link rel="stylesheet" href="{{ url_for('static', filename='style.css')}}">
</head>
<body>

<!-- Nav -->
<div class="nav">
  <div class="nav-inner">
    <div class="brand">
      <span class="badge" aria-hidden="true"></span>
      <span>Lagrangelo web開発チーム</span>
    </div>
    <a class="login" data-guest href="#login" onclick="event.preventDefault(); document.getElementById('memberLoginEmail')?.focus();">ログイン</a>
    <button class="login" data-member hidden type="button" onclick="import('{{ url_for('static', filename='js/firebase-auth.js') }}").then(m => m.doLogout()).catch(console.error)">ログアウト</button>
</div>

<!-- Auth Switcher -->
<section class="auth-section" data-guest>
  <div class="wrap" style="padding-top:12px;">
    <div class="auth-card">
      <h2 style="margin:0">ゲスト向けコンテンツ</h2>
      <p style="margin:4px 0 0; color:#475569;">ログインすると会員機能（お気に入り・コメント・検索履歴）が使えます。</p>
      <form id="memberLoginForm">
        <input id="memberLoginEmail" name="email" type="email" placeholder="Email" required />
        <input id="memberLoginPassword" name="password" type="password" placeholder="Password" required />
        <button type="submit" class="btn primary" style="justify-content:center">ログイン</button>
      </form>
    </div>
  </div>
</section>

<section class="auth-section" data-member hidden>
  <div class="wrap" style="padding-top:12px;">
    <div class="auth-card">
      <h2 style="margin:0">会員向けコンテンツ</h2>
      <p style="margin:4px 0 12px; color:#475569;">Firebaseで認証された会員さま向けの情報です。</p>
      <pre id="member-content" style="margin:0; white-space:pre-wrap; background:#f1f5f9; padding:12px; border-radius:12px; font-size:13px; max-height:180px; overflow:auto;"></pre>
      <div>
        <!-- index.html -->


<!-- Nav 内の例 -->
<a class="login"  data-guest href="#login" onclick="openLoginModal()">ログイン</a>
<button class="signup" data-guest type="button" onclick="signup()">新規登録</button>

<button class="logout" data-member hidden type="button" onclick="doLogout()">
  ログアウト
</button>

<!-- ボタン例 -->
<button type="button" onclick="signup()">新規登録</button>

<script type="module">
  import { getAuth, createUserWithEmailAndPassword, sendEmailVerification } 
    from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";

  const app = initializeApp({ 
  apiKey: "AIzaSyBZabUBc38cEJkjhgLFeuenlwzivKrlhfM",
  authDomain: "lagrangero-group4.firebaseapp.com",
  projectId: "lagrangero-group4",
});
  const auth = getAuth(app);

  // 入力は適宜 document.getElementById('signupEmail') などから取得してね
  window.signup = async () => {
    const email = prompt('メールアドレス');      // ←仮のUI。実際はフォームでOK
    const pass  = prompt('パスワード(6文字以上)');
    const cred = await createUserWithEmailAndPassword(auth, email, pass);
    // 任意: メール認証を使いたい場合
    // await sendEmailVerification(cred.user);
    alert('登録完了！このまま会員UIに切り替わります');
  };
</script>

<!-- ページの最後に追加 -->
<script type="module" src="{{ url_for('static', filename='js/firebase-auth.js') }}"></script>

      </div>
    </div>
  </div>
</section>

<!-- Hero -->
<section class="hero">
  <div class="hero-inner">
    <h1>旅の「いいね」を地図で集める。</h1>
    <p>雑誌のように眺めて、地図で絞り込む。地方→都道府県→市の絞り込み、地図タップの半径検索＆Shift+ドラッグの四角選択、タグでの発見、さらに場所ごとの口コミと★評価まで、ワンページで完結。</p>
  </div>
</section>

<!-- Search & controls -->
<div class="wrap">
  <div class="search-card">
    <div class="search-top">
      <div class="search-wrap">
        <form id="searchForm" class="search-bar" novalidate>
          <input id="q" type="search" inputmode="search" placeholder="キーワード（未入力でもOK：地域/タグ/範囲で絞込）">
          <button>検索</button>
        </form>
      </div>

      <div class="geo-cascade">
        <select id="regionSelect" aria-label="地方">
          <option value="">地方（未選択）</option>
          
        </select>
        <select id="prefSelect" aria-label="都道府県" disabled>
          <option value="">都道府県（まず地方を選択）</option>
        </select>
        <select id="citySelect" aria-label="市区町村" disabled>
          <option value="">市区町村（まず都道府県を選択）</option>
        </select>
        <button id="clearGeo" class="btn ghost" type="button">× 地域クリア</button>
      </div>

      <!-- タグフィルタ（自動生成） -->
      <div class="tagbar" id="tagBar" aria-label="タグで絞り込み"></div>
      <div style="text-align:center; margin:-4px 0 4px;">
        <button id="clearTags" class="btn ghost" type="button">タグ解除</button>
      </div>
    </div>

    <div class="filters">
      <label><input type="checkbox" id="onlyFavs"> お気に入りのみ</label>
      
      <label><input type="checkbox" id="onlyDiscount"> 学割ありのみ</label>
      <label><input type="checkbox" id="boundsOnly"> 表示範囲だけ</label>
      <label><input type="checkbox" id="sortByDistance"> 距離順（現在地）</label>
      <button id="locateBtn" class="btn" type="button">◎ 現在地</button>
      <button id="resetBtn" class="btn" type="button">↺ リセット</button>
      <small id="geoStatus" class="muted"></small>
      <small id="favCounter" class="muted"></small>
    </div>
    <div class="search-history-card" data-member hidden>
      <h3>最近の検索</h3>
      <div id="searchHistoryList" class="search-history-list" aria-live="polite"></div>
    </div>
  </div>
</div>

<!-- Main -->
<main class="wrap" style="padding-top:0">
  <section class="layout">
    <div class="panel">
      <h2>スポット <span id="resultCount" class="muted"></span></h2>
      <div class="list" id="list"></div>
    </div>

    <div class="panel">
      <h2 style="margin:0; padding:12px 14px;">地図（タップ＝円 / Shift+ドラッグ＝四角）</h2>
      <div id="map" aria-label="地図"></div>
      <div class="mapbar">
        <div class="radiusWrap">
          <span class="muted">半径</span>
          <input id="radius" type="range" min="100" max="3000" step="50" value="600">
          <span id="radiusVal" class="muted">600m</span>
        </div>
        <div class="pills" aria-label="半径プリセット">
          <button class="pill" data-r="300">300m</button>
          <button class="pill active" data-r="600">600m</button>
          <button class="pill" data-r="1000">1km</button>
          <button class="pill" data-r="2000">2km</button>
        </div>
        <button id="centerHere" class="btn" type="button">⊙ 中心＝現在地</button>
        <span id="stat" class="muted">選択範囲：なし（地図をタップ / Shift+ドラッグ）</span>
      </div>
    </div>
  </section>
</main>

<footer>© 2025 Lagrangelo web開発チーム · タイル: © <a href="https://www.openstreetmap.org/copyright" target="_blank" rel="noopener">OpenStreetMap contributors</a></footer>

<!-- Slide-in Detail Panel -->
<div id="slidePanel" class="panel-detail" aria-live="polite">
  <div style="display:flex;align-items:center;justify-content:space-between;gap:8px">
    <h3 id="panelTitle" style="margin:0">詳細</h3>
     <div style="display:flex;gap:8px;align-items:center">
      <button id="favInPanel" class="btn fav-btn" type="button">♡ お気に入り</button>
      <button id="closePanel" class="closeBtn" type="button">閉じる</button>
    </div>
  </div>
  <div id="panelContent" class="content"></div>
  <div class="actions">
    <a id="panelLink" class="btn primary" target="_blank" rel="noopener" href="#">公式/学割ページへ</a>
  </div>
</div>

<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- Scripts -->
<script type="module" src="{{ url_for('static', filename='js/firebase-auth.js') }}"></script>
<script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script src="{{url_for('static', filename='index.js')}}"></script>
<script>
  document.getElementById('memberLoginForm')?.addEventListener('submit', async (event) => {
    event.preventDefault();
    const form = event.currentTarget;
    const email = form.email?.value?.trim();
    const password = form.password?.value;
    if (!email || !password) {
      alert('メールアドレスとパスワードを入力してください。');
      return;
    }
    try {
      const mod = await import('{{ url_for('static', filename='js/firebase-auth.js') }}');
      await mod.doLogin(email, password);
    } catch (error) {
      console.error(error);
      alert('ログインに失敗しました。入力内容をご確認ください。');
    }
  });
</script>
</body>
</html>
